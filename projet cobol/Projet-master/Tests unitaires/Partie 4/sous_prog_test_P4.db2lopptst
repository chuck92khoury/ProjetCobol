000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. LOPPTST.
000300
000310 ENVIRONMENT DIVISION.
000320 CONFIGURATION SECTION.
000330 SPECIAL-NAMES.
000340     DECIMAL-POINT IS COMMA.
000350
000400 DATA DIVISION.
000500 WORKING-STORAGE SECTION.
000510
000600 77 SQLCODE      PIC S9(4) COMP VALUE 0.
000610 77 ITEMS-P-NO   PIC X(3) VALUE SPACES.
000620 77 QUANTITY     PIC 9(3) VALUE 0.
000630 77 PRODUCTS-DESCRIPTION PIC X(30) VALUE SPACES.
000631 77 WS-I         PIC 9(2) VALUE 0.
000633 LINKAGE SECTION.
000634 01 GENERATED-RESULTS.
000635     05 GENERATED-RESULT OCCURS 10 TIMES.
000636       10 GENERATED-RANK       PIC 9(2).
000637       10 GENERATED-PRODUCT    PIC X(3).
000638       10 GENERATED-QUANTITY   PIC 9(3).
001000
001100 PROCEDURE DIVISION USING GENERATED-RESULTS.
001101
001110     DISPLAY "RUNNING LOOP-ITEMS TEST".
002200
002210     PERFORM MOCK-FETCH-DATA
002220     PERFORM LOOP-ITEMS
002230
002240     DISPLAY "LOOP-ITEMS TEST COMPLETED".
002250      GOBACK.
002260 MOCK-FETCH-DATA.
002270     MOVE "001" TO ITEMS-P-NO.
002280     MOVE 100 TO QUANTITY.
002290     MOVE "PRODUCT A" TO PRODUCTS-DESCRIPTION.
002291
002293     MOVE 0 TO SQLCODE.
002295 LOOP-ITEMS.
002297     PERFORM UNTIL SQLCODE NOT EQUAL ZERO
002298         ADD 1 TO WS-I
002299         IF WS-I < 3
002300             MOVE WS-I TO GENERATED-RANK(WS-I)
002301             MOVE ITEMS-P-NO TO GENERATED-PRODUCT(WS-I)
002302             MOVE QUANTITY TO GENERATED-QUANTITY(WS-I)
002303         END-IF
002304         PERFORM FETCH-NEXT-PROD
002305     END-PERFORM.
002306 FETCH-NEXT-PROD.
002307     IF WS-I = 1
002308         MOVE "002" TO ITEMS-P-NO
002309         MOVE 50 TO QUANTITY
002310         MOVE "PRODUCT B" TO PRODUCTS-DESCRIPTION
002311     ELSE
002313         MOVE 100 TO SQLCODE
002315     END-IF.
002316
